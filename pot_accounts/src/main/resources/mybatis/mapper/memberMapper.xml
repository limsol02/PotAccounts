<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.example.pot_accounts.Dao.MemberDao">
    <!--회원가입-->
    <insert id="insMem">
        INSERT INTO member
            (member_key, name, id, password, email, confirm)
        VALUES
            ((SELECT nextval('mem_seq') AS member_key), #{name}, #{id}, #{password}, #{email}, '1')
    </insert>

    <!--아이디 중복체크-->
    <select id="checkId" parameterType="String" resultType="int">
        SELECT count(id) FROM MEMBER WHERE id = #{id}
    </select>

    <!--회원가입 시, 개인 가계부 자동생성-->
    <insert id="accSquPlus">
        INSERT INTO accounts (accounts_key) VALUES ((SELECT nextval('acc_seq') AS accounts_key))
    </insert>
    <update id="createAutoAcc">
        UPDATE accounts
        SET
            type = '개인',
            participant = (SELECT currval AS participant FROM sequences WHERE name = 'mem_seq'),
            accounts_title = (SELECT CONCAT(name, '님의 개인가계부') AS accounts_title FROM member mem
                              WHERE (select currval from sequences where name = 'mem_seq') = mem.member_key LIMIT 1)
        where accounts_key = (SELECT currval from sequences where name = 'acc_seq')
    </update>

    <!--로그인-->
    <select id="loginMem" resultType="member" parameterType="member">
        select * from member where id = #{id} and password = #{password}
    </select>

    <!--아이디-->
    <select id="findId" parameterType="member" resultType="String">
        select id from member where name = #{name} and email = #{email}
    </select>
</mapper>